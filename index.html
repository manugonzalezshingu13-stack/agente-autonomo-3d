<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Agente Autónomo 3D - Full Causal System</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; color: #0f0; }
        #ui { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.9); padding: 20px; border: 2px solid #0f0; width: 350px; z-index: 100; }
        input { width: 100%; background: #111; color: #0f0; border: 1px solid #0f0; padding: 10px; margin: 10px 0; outline: none; }
        button { width: 100%; background: #0f0; color: #000; border: none; padding: 15px; cursor: pointer; font-weight: bold; text-transform: uppercase; }
        .console { font-size: 12px; height: 150px; overflow-y: auto; border-top: 1px solid #0f0; margin-top: 15px; padding-top: 10px; }
    </style>
</head>
<body>

<div id="ui">
    <strong>CENTRO DE CONTROL SENSORIAL</strong>
    <div id="status" style="margin-top:10px;">Propiocepción: [0.00, 0.00]</div>
    <input type="text" id="prompt" placeholder="Ej: 'Lleva la manzana a la mesa'...">
    <button onclick="enviarCerebro()">Sincronizar Cerebro</button>
    <div id="log" class="console">> Sistema Iniciado...</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>

<script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0x444444), new THREE.PointLight(0xffffff, 1));
    const room = new THREE.Mesh(new THREE.BoxGeometry(14, 7, 14), new THREE.MeshStandardMaterial({color: 0x1a1a1a, side: THREE.BackSide}));
    scene.add(room);

    const coords = { manzana: {x: 3.5, z: -3}, libro: {x: -3, z: 4}, pelota: {x: -5, z: -4} };
    const agente = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.4, 1.2), new THREE.MeshStandardMaterial({color: 0x00ff00}));
    agente.position.y = 0.6; scene.add(agente);

    camera.position.set(9, 9, 13); camera.lookAt(0,0,0);

    function animate() {
        requestAnimationFrame(animate); renderer.render(scene, camera);
        document.getElementById('status').innerText = `Propiocepción: [${agente.position.x.toFixed(2)}, ${agente.position.z.toFixed(2)}]`;
    }
    animate();

    async function enviarCerebro() {
        const url = "https://eohbp1o3g5llmpv.m.pipedream.net";
        const prompt = document.getElementById('prompt').value.toLowerCase();
        const log = document.getElementById('log');

        log.innerHTML += `<br>> Enviando sensores...`;
        
        try {
            await fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ instruccion: prompt, pos: agente.position })
            });

            log.innerHTML += `<br>> Memoria consultada. Moviendo...`;
            
            let target = null;
            if(prompt.includes("manzana")) target = coords.manzana;
            else if(prompt.includes("libro")) target = coords.libro;
            else if(prompt.includes("pelota")) target = coords.pelota;

            if(target) {
                gsap.to(agente.position, { x: target.x, z: target.z, duration: 2, onComplete: () => { log.innerHTML += `<br>> Acción completada.`; } });
            }
        } catch(e) { log.innerHTML += `<br>> Error de conexión.`; }
    }
</script>
</body>
</html>